<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Submission and Image Viewer</title>
    <script>
        function updateForm() {
            let dropdown = document.getElementById("segmentationDropdown");
            let value = dropdown.options[dropdown.selectedIndex].value;
            let framesDiv = document.getElementById("framesDiv");
            if (value === "resegmentation") {
                framesDiv.style.display = "block";
            } else {
                framesDiv.style.display = "none";
            }
        }

        function onSubmit() {
            let formData = new FormData(document.getElementById('userForm'));
            var data = document.getElementById('userForm')
            let output = "";
            for (let [key, value] of formData.entries()) {
                output += key + ": " + value + "<br>";
            }
            document.getElementById("output").innerHTML = output;
            data.appendChild(document.createTextNode("Is this input correct?"))
            let button = document.createElement("button")
            button.text = "yes";
            button.name = "verify_button";
            data.appendChild(button)
            data_json = getFormJSON(data);
            button.onclick = insertData(data_json);
            return false;  // prevent actual form submission for demonstration
        }
    </script>
</head>
<body>

<h3>Server Configuration</h3>
<form>
    <input type="text" id="serverAddress" placeholder="Enter Server Address">
    <button type="button" onclick="configureServer()">Configure</button>
</form>

<h3>Image Display & Controls</h3>
<img id="displayImage" src="{{ image_url }}" width="320" alt="Image Viewer">
<br>
<button onclick="backward()">Backward</button>
<button onclick="forward()">Forward</button>
<br><br>

<h3>Job Configuration</h3>
<form id="userForm" onsubmit="return onSubmit()" action="/submit_form" method="post">
    Threads: <input type="number" name="threads"><br><br>
    Job: 
    <select name="jobType" id="segmentationDropdown" onchange="updateForm()">
        <option value="initial segmentation">Initial Segmentation</option>
        <option value="resegmentation">Resegmentation</option>
    </select><br><br>
    Job ID: <input type="number" name="jobId"><br><br>
    Reuse Annotation Output: <input type="checkbox" name="reuseAnnotation"><br><br>
    <div id="framesDiv" style="display:none;">
        List of Frame Numbers (comma-separated): <input type="text" name="frames"><br><br>
    </div>
    <input type="submit" value="Submit">
</form>

<h3>Form Data Output</h3>
<div id="output"></div>

<script>
    var server_address = ""
function configureServer() {
    let serverAddress = document.getElementById("serverAddress").value;
    // You can save the server address somewhere or update the form's action attribute, etc.
    server_address = serverAddress
    alert("Configured to server: " + serverAddress);
}
function submitForm(){
            
    var data = document.getElementById("add_website_form");
    data_json = getFormJSON(data);
    insertData(data_json);
    

    
}

/** Sends data to flask app. */
const insertData = (newData) => {
    fetch(server_address, { 
        method: "POST",
        headers: {
            'Content-Type':'application/json'
        },
        body: JSON.stringify(newData)
    })
    .then(resp => resp.json())
    .then((data) => {
        success(data); // display response json from flask to webpage
        console.log(data)
    })
    .catch(error => console.log(error))
}
function backward() {
    fetch('/backward').then(response => response.json()).then(data => {
        document.getElementById("displayImage").src = data.image_url;
    });
}

function forward() {
    fetch('/forward').then(response => response.json()).then(data => {
        document.getElementById("displayImage").src = data.image_url;
    });
}
</script>

</body>
</html>
